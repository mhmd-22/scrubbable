{"version":3,"file":"scrubbable.min.js","sources":["../src/defaults.js","../src/utils.js","../src/index.js"],"sourcesContent":["export default {\r\n    width: 8,\r\n    location: \"left\",\r\n\r\n    value: 0,\r\n    min: 0,\r\n    max: Infinity,\r\n    step: 1,\r\n\r\n    threshold: 14,\r\n    maxAcc: 2,\r\n\r\n    update(value) {\r\n        let attr = this.elm instanceof Element && !this.isInput ? \"textContent\" : \"value\";\r\n        this.elm[attr] = value;\r\n    },\r\n\r\n    onScrub: () => {},\r\n};\r\n","export function listen(el, ev, cb, opt) {\r\n    el.addEventListener(ev, cb, opt);\r\n    return () => el.removeEventListener(ev, cb, opt);\r\n}\r\n\r\nexport function getLockedElement() {\r\n    return (\r\n        document.pointerLockElement ||\r\n        document.mozPointerLockElement ||\r\n        document.webkitPointerLockElement\r\n    );\r\n}\r\n\r\nexport function clamp(v, min, max) {\r\n    return Math.min(max, Math.max(v, min));\r\n}\r\n","import defaults from \"./defaults\";\nimport cursor from \"./cursor\";\nimport { listen, getLockedElement, clamp } from \"./utils\";\n\nconst noop = () => {};\n\nconst scrubbables = new WeakMap();\nlet activeElement;\n\nlet cursorSVG; // pointer-lock hide cursor by default\n\nlet mouseX = 0;\nlet mouseY = 0;\nlet lastMouseX = 0;\n\nexport default function Scrubbable(elm, config) {\n    elm.requestPointerLock =\n        elm.requestPointerLock ||\n        elm.mozRequestPointerLock ||\n        elm.webkitRequestPointerLock ||\n        noop;\n\n    const el = config.zone || elm;\n    const events = [\n        listen(el, \"mousedown\", onMouseDown),\n        listen(el, \"mousemove\", changeMouseIcon),\n        listen(el, \"mouseleave\", changeMouseIcon),\n    ];\n\n    const isInput = [\"INPUT\", \"TEXTAREA\", \"PROGRESS\", \"METER\"].some((tag) => {\n        return tag == elm.tagName;\n    });\n\n    if (isInput) assignInputAttrs(elm, config, defaults);\n\n    if ((isInput || elm.isContentEditable) && !config.noUpdate) {\n        events.push(listen(elm, \"input\", onInputChange));\n    }\n\n    config = { ...defaults, ...config, elm, isInput };\n\n    if (config.decimals === undefined) {\n        const s = config.step.toString();\n        config.decimals = Math.max(0, s.length - (s | 0).toString().length - 1);\n    }\n\n    if (isInput && config.width == \"padding\") {\n        const style = getComputedStyle(elm);\n        const padding = parseInt(style[`padding-${config.location}`], 10);\n\n        if (!isNaN(padding)) config.width = parseInt(padding);\n    }\n\n    scrubbables.set(config.zone || elm, config);\n\n    config.destroy = function () {\n        cancelScrubbing();\n        events.forEach((remove) => remove());\n        scrubbables.delete(config.zone || elm);\n    };\n\n    return config;\n}\n\nconst inputAttrs = [\"value\", \"min\", \"max\", \"step\"];\nfunction assignInputAttrs(el, config, defaults) {\n    inputAttrs.forEach((prop) => {\n        if (config[prop] === undefined) {\n            config[prop] = +el[prop] || defaults[prop];\n        }\n        el[prop] = config[prop];\n    });\n}\n\nfunction onMouseDown(e) {\n    if (e.button !== 0 || !checkMouseZone(e)) return;\n\n    activeElement = this;\n    mouseX = lastMouseX = e.clientX;\n    mouseY = e.clientY;\n\n    this.requestPointerLock();\n    updateMousePosition();\n\n    document.documentElement.style.cursor = \"ew-resize\";\n\n    listen(document, \"mouseup\", cancelScrubbing, { once: true });\n    listen(document, \"mousemove\", onMouseMove, false);\n}\n\nfunction onMouseMove(e) {\n    const config = scrubbables.get(activeElement);\n    if (!config) return;\n\n    const isLocked = getLockedElement();\n    const dx = (isLocked ? e.movementX : e.clientX - mouseX) | 0;\n\n    !isLocked && config.elm.blur(); // prevent text selection\n\n    mouseX += dx;\n\n    if (Math.abs(mouseX - lastMouseX) > config.threshold) {\n        const acc = clamp(dx, -config.maxAcc, config.maxAcc);\n        const increment = acc * config.step;\n\n        config.value = clamp(config.value + increment, config.min, config.max);\n\n        if (config.update) {\n            let value = config.value;\n            if (config.decimals) {\n                value = value.toFixed(config.decimals);\n            }\n\n            config.update(value, increment, config);\n        }\n\n        config.onScrub(config.value, increment, config);\n        lastMouseX = mouseX;\n    }\n\n    if (isLocked) {\n        if (mouseX < 0) mouseX = window.innerWidth;\n        if (mouseX > window.innerWidth) mouseX = 0;\n    }\n\n    updateMousePosition();\n}\n\nfunction updateMousePosition() {\n    cursorSVG.style.transform = `translate(${mouseX - 10}px, ${mouseY - 3}px)`;\n}\n\nfunction checkMouseZone(e) {\n    const elm = activeElement || e.currentTarget;\n    const opt = scrubbables.get(elm);\n    const rect = elm.getBoundingClientRect();\n\n    return (\n        opt.zone ||\n        opt.width == \"full\" ||\n        Math.abs(rect[opt.location] - e.clientX) < opt.width\n    );\n}\n\nfunction changeMouseIcon(e) {\n    const set = e.type == \"mouseleave\" || checkMouseZone(e);\n    this.style.cursor = set ? \"ew-resize\" : \"\";\n}\n\nfunction cancelScrubbing() {\n    document.exitPointerLock();\n    document.removeEventListener(\"mousemove\", onMouseMove, false);\n    document.documentElement.style.cursor = \"\";\n    cursorSVG.style.display = \"none\";\n    activeElement = undefined;\n}\n\nfunction onInputChange() {\n    const config = scrubbables.get(this);\n    if (config) {\n        config.value = parseInt(config.isInput ? this.value : this.textContent, 10);\n    }\n}\n\nlisten(window, \"load\", () => {\n    document.body.insertAdjacentHTML(\"beforeend\", cursor);\n    cursorSVG = document.body.lastElementChild;\n    cursorSVG.style.cssText = `position:fixed;top:0;left:0;display:none;`;\n});\n\nfunction onPointerLockChange() {\n    if (getLockedElement()) cursorSVG.style.display = \"block\";\n}\n\nlisten(document, \"pointerlockchange\", onPointerLockChange, false);\nlisten(document, \"mozpointerlockchange\", onPointerLockChange, false);\nlisten(document, \"webkitpointerlockchange\", onPointerLockChange, false);\n\ndocument.exitPointerLock =\n    document.exitPointerLock ||\n    document.mozExitPointerLock ||\n    document.webkitExitPointerLock ||\n    noop;\n"],"names":["width","location","value","min","max","Infinity","step","threshold","maxAcc","update","attr","this","elm","Element","isInput","onScrub","listen","el","ev","cb","opt","addEventListener","removeEventListener","getLockedElement","document","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","clamp","v","Math","activeElement","cursorSVG","noop","scrubbables","WeakMap","mouseX","mouseY","lastMouseX","inputAttrs","onMouseDown","e","button","checkMouseZone","clientX","clientY","requestPointerLock","updateMousePosition","documentElement","style","cursor","cancelScrubbing","once","onMouseMove","config","get","isLocked","dx","movementX","blur","abs","increment","decimals","toFixed","window","innerWidth","transform","currentTarget","rect","getBoundingClientRect","zone","changeMouseIcon","set","type","exitPointerLock","display","undefined","onInputChange","parseInt","textContent","onPointerLockChange","body","insertAdjacentHTML","lastElementChild","cssText","mozExitPointerLock","webkitExitPointerLock","mozRequestPointerLock","webkitRequestPointerLock","events","some","tag","tagName","defaults","forEach","prop","assignInputAttrs","isContentEditable","noUpdate","push","s","toString","length","getComputedStyle","padding","isNaN","destroy","remove","delete"],"mappings":"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"}