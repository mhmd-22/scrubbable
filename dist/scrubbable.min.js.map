{"version":3,"file":"scrubbable.min.js","sources":["../src/defaults.js","../src/utils.js","../src/index.js"],"sourcesContent":["export default {\r\n    width: 8,\r\n    location: \"left\",\r\n\r\n    value: 0,\r\n    min: 0,\r\n    max: Infinity,\r\n    step: 1,\r\n\r\n    threshold: 14,\r\n    maxAcc: 2,\r\n\r\n    update(value) {\r\n        let attr = this.elm instanceof Element && !this.isInput ? \"textContent\" : \"value\";\r\n        this.elm[attr] = value;\r\n    },\r\n\r\n    onScrub: () => {},\r\n};\r\n","export function listen(el, ev, cb, opt) {\r\n    el.addEventListener(ev, cb, opt);\r\n    return () => el.removeEventListener(ev, cb, opt);\r\n}\r\n\r\nexport function getLockedElement() {\r\n    return (\r\n        document.pointerLockElement ||\r\n        document.mozPointerLockElement ||\r\n        document.webkitPointerLockElement\r\n    );\r\n}\r\n\r\nexport function clamp(v, min, max) {\r\n    return Math.min(max, Math.max(v, min));\r\n}\r\n","import defaults from \"./defaults\";\nimport cursor from \"./cursor\";\nimport { listen, getLockedElement, clamp } from \"./utils\";\n\nconst noop = () => {};\n\nconst scrubbables = new WeakMap();\nlet activeElement;\n\nlet cursorSVG; // pointer-lock hide cursor by default\n\nlet mouseX = 0;\nlet mouseY = 0;\nlet lastMouseX = 0;\n\nexport default function Scrubbable(elm, config = {}) {\n    elm.requestPointerLock =\n        elm.requestPointerLock ||\n        elm.mozRequestPointerLock ||\n        elm.webkitRequestPointerLock ||\n        noop;\n\n    const el = config.zone || elm;\n    const events = [\n        listen(el, \"mousedown\", onMouseDown),\n        listen(el, \"mousemove\", changeMouseIcon),\n        listen(el, \"mouseleave\", changeMouseIcon),\n    ];\n\n    const isInput = [\"INPUT\", \"TEXTAREA\", \"PROGRESS\", \"METER\"].some((tag) => {\n        return tag == elm.tagName;\n    });\n\n    if (isInput) assignInputAttrs(elm, config, defaults);\n\n    if ((isInput || elm.isContentEditable) && !config.noUpdate) {\n        events.push(listen(elm, \"input\", onInputChange));\n    }\n\n    config = { ...defaults, ...config, elm, isInput };\n\n    if (config.decimals === undefined) {\n        const s = config.step.toString();\n        config.decimals = Math.max(0, s.length - (s | 0).toString().length - 1);\n    }\n\n    if (isInput && config.width == \"padding\") {\n        const style = getComputedStyle(elm);\n        const padding = parseInt(style[`padding-${config.location}`], 10);\n\n        if (!isNaN(padding)) config.width = parseInt(padding);\n    }\n\n    scrubbables.set(config.zone || elm, config);\n\n    config.destroy = function () {\n        cancelScrubbing();\n        events.forEach((remove) => remove());\n        scrubbables.delete(config.zone || elm);\n    };\n\n    return config;\n}\n\nconst inputAttrs = [\"value\", \"min\", \"max\", \"step\"];\nfunction assignInputAttrs(el, config, defaults) {\n    inputAttrs.forEach((prop) => {\n        if (config[prop] === undefined) {\n            config[prop] = +el[prop] || defaults[prop];\n        }\n        el[prop] = config[prop];\n    });\n}\n\nfunction onMouseDown(e) {\n    if (e.button !== 0 || !checkMouseZone(e)) return;\n\n    activeElement = this;\n    mouseX = lastMouseX = e.clientX;\n    mouseY = e.clientY;\n\n    this.requestPointerLock();\n    updateMousePosition();\n\n    document.documentElement.style.cursor = \"ew-resize\";\n\n    listen(document, \"mouseup\", cancelScrubbing, { once: true });\n    listen(document, \"mousemove\", onMouseMove, false);\n}\n\nfunction onMouseMove(e) {\n    const config = scrubbables.get(activeElement);\n    if (!config) return;\n\n    const isLocked = getLockedElement();\n    const dx = (isLocked ? e.movementX : e.clientX - mouseX) | 0;\n\n    !isLocked && config.elm.blur(); // prevent text selection\n\n    mouseX += dx;\n\n    if (Math.abs(mouseX - lastMouseX) > config.threshold) {\n        const acc = clamp(dx, -config.maxAcc, config.maxAcc);\n        const increment = acc * config.step;\n\n        config.value = clamp(config.value + increment, config.min, config.max);\n\n        if (config.update) {\n            let value = config.value;\n            if (config.decimals) {\n                value = value.toFixed(config.decimals);\n            }\n\n            config.update(value, increment, config);\n        }\n\n        config.onScrub(config.value, increment, config);\n        lastMouseX = mouseX;\n    }\n\n    if (isLocked) {\n        if (mouseX < 0) mouseX = window.innerWidth;\n        if (mouseX > window.innerWidth) mouseX = 0;\n    }\n\n    updateMousePosition();\n}\n\nfunction updateMousePosition() {\n    cursorSVG.style.transform = `translate(${mouseX - 10}px, ${mouseY - 3}px)`;\n}\n\nfunction checkMouseZone(e) {\n    const elm = activeElement || e.currentTarget;\n    const opt = scrubbables.get(elm);\n    const rect = elm.getBoundingClientRect();\n\n    return (\n        opt.zone ||\n        opt.width == \"full\" ||\n        Math.abs(rect[opt.location] - e.clientX) < opt.width\n    );\n}\n\nfunction changeMouseIcon(e) {\n    const set = e.type == \"mouseleave\" || checkMouseZone(e);\n    this.style.cursor = set ? \"ew-resize\" : \"\";\n}\n\nfunction cancelScrubbing() {\n    document.exitPointerLock();\n    document.removeEventListener(\"mousemove\", onMouseMove, false);\n    document.documentElement.style.cursor = \"\";\n    cursorSVG.style.display = \"none\";\n    activeElement = undefined;\n}\n\nfunction onInputChange() {\n    const config = scrubbables.get(this);\n    if (config) {\n        config.value = parseInt(config.isInput ? this.value : this.textContent, 10);\n    }\n}\n\nlisten(window, \"load\", () => {\n    document.body.insertAdjacentHTML(\"beforeend\", cursor);\n    cursorSVG = document.body.lastElementChild;\n    cursorSVG.style.cssText = `position:fixed;top:0;left:0;display:none;`;\n});\n\nfunction onPointerLockChange() {\n    if (getLockedElement() && cursorSVG) cursorSVG.style.display = \"block\";\n}\n\nlisten(document, \"pointerlockchange\", onPointerLockChange, false);\nlisten(document, \"mozpointerlockchange\", onPointerLockChange, false);\nlisten(document, \"webkitpointerlockchange\", onPointerLockChange, false);\n\ndocument.exitPointerLock =\n    document.exitPointerLock ||\n    document.mozExitPointerLock ||\n    document.webkitExitPointerLock ||\n    noop;\n"],"names":["width","location","value","min","max","Infinity","step","threshold","maxAcc","update","attr","this","elm","Element","isInput","onScrub","listen","el","ev","cb","opt","addEventListener","removeEventListener","getLockedElement","document","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","clamp","v","Math","activeElement","cursorSVG","noop","scrubbables","WeakMap","mouseX","mouseY","lastMouseX","inputAttrs","assignInputAttrs","config","defaults","forEach","prop","undefined","onMouseDown","e","button","checkMouseZone","clientX","clientY","requestPointerLock","updateMousePosition","documentElement","style","cursor","cancelScrubbing","once","onMouseMove","get","isLocked","dx","movementX","blur","abs","increment","decimals","toFixed","window","innerWidth","transform","currentTarget","rect","getBoundingClientRect","zone","changeMouseIcon","set","type","exitPointerLock","display","onInputChange","parseInt","textContent","onPointerLockChange","body","insertAdjacentHTML","lastElementChild","cssText","mozExitPointerLock","webkitExitPointerLock","mozRequestPointerLock","webkitRequestPointerLock","events","some","tag","tagName","isContentEditable","noUpdate","push","s","toString","length","getComputedStyle","padding","isNaN","destroy","remove","delete"],"mappings":"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"}